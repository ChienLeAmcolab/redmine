# Redmine Dashboard Plugin Documentation

## 1. Giới thiệu

`redmine_dashboard` là một plugin cho Redmine giúp bạn nhúng màn hình Dashboard thông qua iframe, cả ở phạm vi toàn cục (global) và theo từng dự án (project). Bạn có thể cấu hình:

* **Global Dashboard**: sử dụng URL mặc định cho toàn cục.
* **Project Dashboard**: nhập URL riêng cho mỗi dự án, ghi đè URL global.
* **Preview** ngay trên trang Overview của từng dự án.

---

## 2. Cấu trúc & các thành phần chính

```
redmine_dashboard/             # Thư mục plugin
├── init.rb                    # Khai báo plugin, permissions, menu, settings
├── config/
│   ├── routes.rb              # Định nghĩa route cho các dashboard và settings
│   └── locales/
│       ├── en.yml             # Chuỗi i18n tiếng Anh
│       └── vi.yml             # Chuỗi i18n tiếng Việt
├── app/
│   ├── controllers/
│   │   ├── dashboard_controller.rb            # index (project) & global actions
│   │   └── project_dashboard_settings_controller.rb  # edit/update URL theo project
│   ├── views/
│   │   ├── dashboard/
│   │   │   ├── index.html.erb    # View project-dashboard (iframe)
│   │   │   ├── global.html.erb   # View global-dashboard (iframe)
│   │   │   └── _project_overview.html.erb  # Partial preview trên Overview
│   │   ├── project_dashboard_settings/
│   │   │   └── edit.html.erb     # Form cài đặt URL per-project
│   │   └── settings/
│   │       └── _dashboard_settings.html.erb  # Form cài đặt global default URL
├── lib/
│   └── redmine_dashboard/hooks/view_hooks.rb  # Hook chèn preview vào Overview
└── README.rdoc               # Chưa ghi nội dung
```

---

## 3. Cài đặt

1. **Đặt thư mục** `redmine_dashboard` vào `plugins/` của Redmine.
2. Chạy:

   ```bash
   bundle install
   ```
3. Khởi động lại Redmine:

   ```bash
   cd /path/to/redmine
   ```

touch tmp/restart.txt

```
4. (Tuỳ chọn) Cấp quyền cho các role:
- **View Dashboard (global)**: để hiện tab Global Dashboard trên menu trắng (`application_menu`).
- **View Dashboard (project)**: để hiện tab Dashboard trong menu dự án.
- **Configure Project Dashboard**: để hiện tab Dashboard Settings trong phần Settings của project.

---

## 4. Cấu hình

### 4.1. Global default URL

- Vào **Administration → Plugins → Redmine Dashboard → Configure**.
- Nhập `default_url` (ví dụ: `https://lookerstudio.google.com/embed/…`).

### 4.2. Per-project URL override

- Trong **Project Settings → Dashboard Settings**, nhập URL riêng cho dự án.
- Nếu để trống, plugin sẽ dùng URL global.
- Ngoài ra bạn có thể tạo một Custom Field kiểu Text có tên **Dashboard URL** (Project custom field). Giá trị của field này sẽ được đọc tự động.

---

## 5. Sử dụng

- **Global Dashboard**: tab xuất hiện cạnh `Projects` trên trang `/projects` (application_menu). Hiển thị iframe với URL global.
- **Project Dashboard**: tab xuất hiện trong **Project menu** (Overview, Activity, …). Hiển thị iframe với URL theo thứ tự ưu tiên: URL truyền param `?url=…`, Project custom field, Project Settings, Global default.
- **Preview** nhỏ: xem nhanh Dashboard trên khung bên phải màn **Project Overview** nhờ hook `view_projects_show_right`.

---

## 6. Permissions

- `:view_dashboard` (global: true): cho phép truy cập Global Dashboard.
- `:view_dashboard` (project-module): cho phép truy cập Project Dashboard.
- `:configure_project_dashboard`: cho phép sửa URL trong Project Settings.

Đặt quyền tại **Administration → Roles and permissions**:
- Chọn role (Non-member cho global, Member/Manager cho project), tích các permission tương ứng.

---

## 7. Routes

```

GET  /dashboard                           → dashboard#global      (as: global\_dashboard)
GET  /projects/\:project\_id/dashboard      → dashboard#index       (as: project\_dashboard)
GET  /projects/\:project\_id/dashboard\_settings → project\_dashboard\_settings#edit  (as: edit\_project\_dashboard\_settings)
PUT  /projects/\:project\_id/dashboard\_settings → project\_dashboard\_settings#update (as: project\_dashboard\_settings)

````

---

## 8. View Hooks

Plugin dùng `Redmine::Hook::ViewListener`:
```ruby
render_on :view_projects_show_right,
           partial: 'dashboard/project_overview'
````

để hiển thị preview Dashboard (iframe) trong sidebar của màn **Project Overview**.

---

## 9. Tùy biến

* Thêm CSS/JS vào `assets/stylesheets` hoặc `assets/javascripts` của plugin để điều chỉnh kích thước, layout iframe.
* Bạn có thể override các view trong Redmine bằng cách copy file cùng đường dẫn lên plugin.

---

## 10. Gỡ bỏ

1. Xoá thư mục plugin:

   ```bash
   rm -rf plugins/redmine_dashboard
   ```
2. Khởi động lại Redmine:

   ```bash
   touch tmp/restart.txt
   ```
3. (Nếu tạo Custom Field) Xoá Custom Field `Dashboard URL` nếu không còn dùng nữa.

---

*Document generated by reviewing the `redmine_dashboard` plugin code.*
