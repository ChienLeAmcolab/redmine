<% project = local_assigns[:project] || (defined?(@project) ? @project : nil) %>
<% if project %>
  <% share_token = SharedHelper.generate_project_token(project) %>
  <% share_url = "#{Setting.host_name}/share/project/#{project.identifier}?token=#{share_token}" %>

  <button id="copy-share-project-<%= project.id %>" class="share-link-button"
          data-share-url="<%= share_url %>">
    üîó Chia s·∫ª D·ª± √Ån & Copy Link
  </button>
<% end %>
<style>
    .share-link-button {
        cursor: pointer;
    }
</style>
<script type="text/javascript">
    $(document).ready(function() {
        $('.share-link-button').on('click', function(e) {
            e.preventDefault();
            var url = $(this).data('share-url');

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url)
                    .then(function() {
                        alert('ƒê√£ sao ch√©p link chia s·∫ª v√†o clipboard: ' + url);
                    })
                    .catch(function(err) {
                        console.error('Clipboard copy failed', err);
                        alert('Kh√¥ng th·ªÉ copy t·ª± ƒë·ªông. B·∫°n h√£y copy th·ªß c√¥ng: ' + url);
                    });
            } else {
                // Fallback n·∫øu tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Clipboard API
                var $tempInput = $('<input>');
                $('body').append($tempInput);
                $tempInput.val(url).select();
                try {
                    document.execCommand('copy');
                    alert('ƒê√£ sao ch√©p link chia s·∫ª v√†o clipboard: ' + url);
                } catch (e) {
                    alert('Link chia s·∫ª: ' + url);
                }
                $tempInput.remove();
            }
        });
    });
</script>
